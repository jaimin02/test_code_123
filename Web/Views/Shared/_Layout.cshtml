<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>@* href="@Url.Content("~/Content/themes/bootstrap/css/bootstrap.min.css")">*@
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/bootstrap/css/bootstrap.min.css")">
    <link rel="icon" type="image/ico" href="~/Content/Images/favicon1.ico" />

    <!-- DataTables -->
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/datatables/dataTables.bootstrap.css")">
    <!-- Font Awesome -->
    @*<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">*@
    <link href="@Url.Content("~/Content/themes/bootstrap/css/font-awesome.min.css")" rel="stylesheet" />

    @*<link href="~/Content/themes/base/font-awesome.min.css" rel="stylesheet" />*@
    <!-- Ionicons -->
    @*<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">*@
    <link href="@Url.Content("~/Content/themes/bootstrap/css/ionicons.css")" rel="stylesheet" />


    <link href="~/Content/material.tree.css" rel="stylesheet" />
    <link href="~/Content/tree.css" rel="stylesheet" />

    <!-- Theme style -->
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/css/AdminLTE.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/css/skins/_all-skins.min.css")">
    <!-- iCheck -->
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/iCheck/flat/blue.css")">
    <!-- Morris chart -->

    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/morris/morris.css")">
    <!-- jvectormap -->
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/jvectormap/jquery-jvectormap-1.2.2.css")">
    <!-- Date Picker -->
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/datepicker/datepicker3.css")">
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/datetimepicker/bootstrap-datetimepicker.min.css")">
    @*<link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/datetimepicker/bootstrap-datetimepicker.min.css")">*@
    <!-- Daterange picker -->
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/daterangepicker/daterangepicker-bs3.css")">
    <!-- bootstrap wysihtml5 - text editor -->
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css")">
    <!-- Custom style sheet- CSS - text editor -->
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/css/CustomStyle.css")" />

    <script src="@Url.Content("~/Content/themes/plugins/jQuery/jQuery-2.2.0.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/jQuery/jquery-ui.min.js")"></script>
    <style>
        .ui-tooltip {
            display: none !important;
        }

        .passwordtxt {
            font-family: text-security-disc;
            -webkit-text-security: disc !important;
        }
    </style>
</head>
<body class="sidebar-mini skin-green sidebar-collapse">
    <div class="wrapper">
        <header class="main-header">

            <!-- Logo -->
            <a href="..\PmsHome\Home" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini">
                    <img src="~/Content/Images/PM.png" height="30px" width="30px" />
                </span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg">
                    <img src="~/Content/Images/IMPTrackLogo.png" height="45" />
                </span>
            </a>

            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                </a>
                <ul class="nav-right pull-right list-inline icons-list">
                    <li class="dropdown profile user-header">
                        <a class="dropdown-toggle" data-toggle="dropdown">
                            <div>
                                <i class="glyphicon glyphicon-off"></i>
                                <span id="spnwelcome"></span>
                            </div>
                        </a>
                        <ul class="dropdown-menu animated littleFadeInRight pull-right" role="menu">
                            <li>
                                <a role="button" tabindex="0">
                                    <div>
                                        <i class="icon-login fa fa-sign-in"></i>Login Time: <span id="spnLoginTime" class="spnvalue">16-Jun-2016 </span>
                                    </div>
                                </a>
                            </li>

                            <li>
                                <a role="button" tabindex="0">
                                    <div>
                                        <i class="icon-login fa fa-sign-out"></i>Last Logged In: <span id="spnLastLoggedInTime" class="spnvalue">16-Jun-2016 </span>
                                    </div>
                                </a>
                            </li>

                            <li><a role="button" tabindex="0">
                                <div><i class="fa fa-user"></i>Welcome: <span id="spnprofile" class="spnvalue">cpmaadmin</span></div>
                            </a>
                            </li>
                            <li>
                                <a role="button" tabindex="0" id="Logout">
                                    <div><i class="icon-logout fa fa-sign-out"></i>Logout</div>
                                </a>
                            </li>

                        </ul>

                    </li>
                </ul>
                <div class="welcome col-lg-9 col-md-10 col-sm-10 col-xs-10" style="float: right;">
                    <div class="col-sm-4 text-center" style="/*margin-top: -1.5%*/">
                        @*<img src="../Content/Images/watch.png" style="display: none; height: 25px; width: 25px" />*@
                        <div id="DivSessionTimingWatch" style="padding: 0px; width: 85%; display: block; border-style: double; border-color: rgb(45, 166, 197); border-radius: 15px; box-shadow: #00BCD4 1px 0px 3px 3px;">
                            <span class="spancolr">Session Expires In: </span><span class="spndatetime" id="timerText"></span>
                        </div>
                    </div>
                    <div class="col-sm-5">
                        <span class="spancolr">Change Profile </span>
                        <span>
                            <select id="ddlProfile"></select>
                        </span>
                    </div>
                    <div class="col-sm-3">
                        <span class="spancolr">Location 
                        </span>
                        <span>
                            <select id="ddlUserLocation">
                            </select>
                        </span>
                    </div>

                </div>
            </nav>

        </header>

        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <ul class="sidebar-menu" id="DyanamicMenu">
                </ul>
            </section>
        </aside>
        @RenderBody()
        <div id="MasterLoader" class="modal MasterLoader"></div>


        <footer class="main-footer" style="background-color: #2a498f; color: white; text-align: center;">
            <strong>Developed & Implemented By : Sarjen Systems Pvt. Ltd. </strong>
        </footer>

    </div>
    <div class="modal splash fade" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true" id="divChangePassword1" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-xs">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" id="changeClose">&times;</button>
                    <h4 class="modal-title modaltitle text-center">Change Password</h4>
                </div>
                <div class="modal-body">
                    <div class="box-body">
                        <form name="form1" role="form" id="formChangePassword1" align="center">
                            <div class="row form-group col-sm-12">
                                <div class="col-sm-2"></div>
                                <div class="col-sm-4">
                                    <label>Old Password: </label>
                                </div>
                                <div class="col-sm-4">
                                    <input type="text" name="txtOldPass1" id="txtOldPass1" class="form-control passwordtxt"
                                        placeholder="Password"
                                        autocomplete="off"
                                        data-parsley-trigger="change"
                                        maxlength="20"
                                        required>
                                </div>
                                <div class="col-sm-2"></div>
                            </div>
                            <div class="row form-group col-sm-12">
                                <div class="col-sm-2"></div>
                                <div class="col-sm-4">
                                    <label>New Password: </label>
                                </div>
                                <div class="col-sm-4">
                                    <input type="text" name="txtNewPass1" id="txtNewPass1" class="form-control passwordtxt"
                                        placeholder="Password"
                                        autocomplete="off"
                                        data-parsley-trigger="change"
                                        maxlength="20"
                                        required>
                                </div>
                                <div class="col-sm-2"></div>
                            </div>
                            <div class="row form-group col-sm-12">
                                <div class="col-sm-2"></div>
                                <div class="col-sm-4">
                                    <label>Confirm Password:</label>
                                </div>
                                <div class="col-sm-4">
                                    <input type="text" name="txtConfirmPass1" id="txtConfirmPass1" class="form-control passwordtxt"
                                        placeholder="Password"
                                        data-parsley-trigger="change"
                                        autocomplete="off"
                                        maxlength="20"
                                        data-parsley-equalto="#txtNewPass1"
                                        required>
                                </div>
                                <div class="col-sm-2"></div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 form-group text-center">
                                    <div class="col-xs-12">
                                        <button type="button" id="btnChangePass1" class="btn btn-success btn-ef btn-ef-3 btn-ef-3c" value="Change Password"
                                            data-tooltip="tooltip" disabled="disabled" onclick="return changePasswordClick();" title="Change Password">
                                            <i class="fa fa-arrow-right"></i>Change Password</button>

                                        <button type="button" id="btnExitChangepass1" value="Exit" class="btn btn-lightred btn-ef btn-ef-4 btn-ef-4c"
                                            role="button" title="Exit" data-toggle="modal">
                                            <i class="fa fa-arrow-left"></i>Exit</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <!-- ./wrapper -->
    <input type="hidden" value="@ViewBag.hdnUserTypeCode" id="hdnUserTypeCode" />
    <input type="hidden" value="@ViewBag.hdnUserLocationCode" id="hdnUserLocationCode" />
    <input type="hidden" value="@ViewBag.hdnUserNameWithProfile" id="hdnUserNameWithProfile" />
    <input type="hidden" value="@ViewBag.hdnuserid" id="hdnuserid" />
    <input type="hidden" value="@ViewBag.hdnlogintime" id="hdnlogintime" />
    <input type="hidden" value="@ViewBag.hdnUserName" id="hdnUserName" />
    <input type="hidden" value="@ViewBag.hdnscopevalues" id="hdnscopevalues" />
    <input type="hidden" value="@ViewBag.hdnOperationcode" id="hdnOperationcode" />
    <input type="hidden" value="@ViewBag.hdnViewModeID" id="hdnViewModeID" />
    <input type="hidden" value="@ViewBag.hdnIpAddress" id="hdnIpAddress" />
    <input type="hidden" value="@ViewBag.hdnUserTypeName" id="hdnUserTypeName" />
    <input type="hidden" value="@ViewBag.hdnLastLoggedInTime" id="hdnLastLoggedInTime" />
     <input type="hidden" value="@ViewBag.hdnExpired" id="hdnExpired" />
    <input type="hidden" value="" id="hdnvUserAgent" />
    @Html.Hidden("RedirectToHome", Url.Action("Home", "PmsHome"))
    @Html.Hidden("RedirectToLogin", Url.Action("Login", "PMSLogin"))

    @*<input type="hidden" value="@ViewBag.hdnApi_Url" id="hdnApi_Url" />
    <input type="hidden" value="@ViewBag.hdnWeb_Url" id="hdnWeb_Url" />*@



    <script src=@Url.Content("~/Scripts/parsley.min.js")></script>

    @*<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>*@
    <script>
        $.widget.bridge('uibutton', $.ui.button);
    </script>
    <script src="@Url.Content("~/Content/themes/bootstrap/js/bootstrap.min.js")"></script>

    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>*@
    <script src="@Url.Content("~/Content/themes/plugins/morris/raphael-min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/morris/morris.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/sparkline/jquery.sparkline.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/jvectormap/jquery-jvectormap-world-mill-en.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/knob/jquery.knob.js")"></script>

    <script src="@Url.Content("~/Content/themes/plugins/daterangepicker/daterangepicker.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/datetimepicker/moment.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/datetimepicker/bootstrap-datetimepicker.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/datepicker/bootstrap-datepicker.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/jQuery/jquery-ui.min.js")"></script>
    <!-- DataTables -->
    <script src="../Content/themes/plugins/datatables/jquery.dataTables.min.js"></script>
    @*add for auto complete*@
    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/4.0.1/bootstrap3-typeahead.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>*@
    <script src="@Url.Content("~/Content/themes/js/bootstrap3-typeahead.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/daterangepicker/moment.min.js")"></script>

    <script src="@Url.Content("~/Content/themes/plugins/multiselect/bootstrap-multiselect.js")"></script>
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/plugins/multiselect/bootstrap-multiselect.css")">

    <script src="@Url.Content("~/Content/themes/plugins/datatables/dataTables.bootstrap.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/slimScroll/jquery.slimscroll.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/plugins/fastclick/fastclick.js")"></script>
    <script src="@Url.Content("~/Content/themes/js/app.min.js")"></script>
    <script src="@Url.Content("~/Content/themes/js/pages/dashboard.js")"></script>
    <script src="@Url.Content("~/Scripts/Validation.js")"></script>
    <script src="@Url.Content("~/Scripts/General.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery-barcode.js")"></script>


    <script>

        $(document).ready(function () {


            $(document).ajaxStart(function () {
                $("#loader").css("display", "block");
                $('.MasterLoader').show();
                $('.scrollingtemp').scrollTop(0);
            });
            $(document).ajaxComplete(function () {
                $("#loader").css("display", "none");
                $('.MasterLoader').hide();
            });

            ////$(document).keydown(function (event) {
            ////    if (event.keyCode == 123) {
            ////        return false;
            ////    }
            ////    else if (event.ctrlKey && event.shiftKey && event.keyCode == 73) {
            ////        return false;  //Prevent from ctrl+shift+i
            ////    }
            ////});

            ////$(document).on("contextmenu", function (e) {
            ////    e.preventDefault();
            ////});

        });
        var BaseUrl = BaseUrl;
        var MenuID;
        var sTime = new Date().getTime();
        var countDown = 18000; // Number of seconds to count down from.        

        function UpdateCountDownTime() {
            var cTime = new Date().getTime();
            var diff = cTime - sTime;
            var timeStr = '';
            var seconds = countDown - Math.floor(diff / 1000);

            if (seconds == 300) {
                if (confirm('Your session will expire within 5 mins.')) {
                }
                else {
                    if (countDown - Math.floor((new Date().getTime() - sTime) / 1000) <= 1) {
                        var url = $("#RedirectToLogin").val();
                        alert('Your session has expired!');
                        LogoutEntry();
                        location.href = url;
                        clearInterval(counter);
                    }
                    countDown = 1800;
                    sTime = new Date().getTime();
                }
            }
            if (seconds >= 0) {
                var hours = Math.floor(seconds / 3600);
                var minutes = Math.floor((seconds - (hours * 3600)) / 60);
                seconds -= (hours * 3600) + (minutes * 60);
                if (hours < 10) {
                    timeStr = "0" + hours;
                } else {
                    timeStr = hours;
                }
                if (minutes < 10) {
                    timeStr = timeStr + ":0" + minutes;
                } else {
                    timeStr = timeStr + ":" + minutes;
                }
                if (seconds < 10) {
                    timeStr = timeStr + ":0" + seconds;
                } else {
                    timeStr = timeStr + ":" + seconds;
                }
                document.getElementById("timerText").innerHTML = timeStr;
            }
            else {
                //document.getElementById("timerText").style.display = "none";
                var url = $("#RedirectToLogin").val();
                alert('Your session has expired!');
                LogoutEntry();
                location.href = url;
                clearInterval(counter);
            }
        }

        UpdateCountDownTime();
        var counter = setInterval(UpdateCountDownTime, 30);



        $(document).ajaxStart(function () {
            if (sessionStorage.getItem("IsChangeProfile") == "true") {
                LogoutEntry();
            }
            else {
                var SaveUserLoginData = {
                    iUserId: $("#hdnuserid").val(),
                    vIPAddress: $('#hdnIpAddress').val(),
                    vGUID: '@Session["vGUID"]',
                    DATAOPMODE: 2
                }
                $.ajax({
                    url: BaseUrl + "PmsLogin/save_UserLoginDetails",
                    type: 'POST',
                    data: SaveUserLoginData,
                    async: false,
                    success: SuccessLoginData1,
                    error: function () {
                        alert("Error while saving details of User Login details !");
                    }
                });

                function SuccessLoginData1(JsonData_UserLoginDetails) {

                    if (JsonData_UserLoginDetails.length == 0) {
                        LogoutEntry();
                        location.href = '@Url.Action("Login", "PMSLogin")';
                    }
                    else {
                        var browser = JsonData_UserLoginDetails[0].vUserAgent.trim();
                        $("#hdnvUserAgent").val(browser);
                    }
                    return true;
                }
            }
        });

        function LogoutEntry() {
            var SaveUserLoginData = {
                iUserId: $("#hdnuserid").val(),
                vIPAddress: $('#hdnIpAddress').val(),
                DATAOPMODE: 3
            }
            $.ajax({
                url: BaseUrl + "PmsLogin/save_UserLoginDetails",
                type: 'POST',
                data: SaveUserLoginData,
                async: false,
                success: function () { return true; },
                error: function () {
                    //location.href = '@Url.Action("Login", "PMSLogin")';
                }
            });
        }
        $("#btnExitChangepass1").on("click", function () {
            var result = confirm(ConfirmMessage);
            if (result) {
                $("#divChangePassword1").modal('hide');
            }
            else {
                return false;
            }
        });

        function changePasswordClick() {
            var chkpass;

            var SaveUserLoginData = {
                iUserId: $("#hdnuserid").val(),
                vUserTypeCode: $("#hdnUserTypeCode").val(),
                vLoginPass: $("#txtOldPass1").val()
            }
            $.ajax({
                url: BaseUrl + "PmsRecordFetch/CheckOldPassword",
                type: 'POST',
                data: SaveUserLoginData,
                async: false,
                success: function (passwordMatch) {
                    chkpass = passwordMatch
                },
                error: function () {
                    alert("Error while Get old password !");
                }
            });
            if (!chkpass) {
                alert("Old password is Wrong");
                return false;
            }

            var SaveUserMasterData = {
                iUserId: $("#hdnuserid").val(),
                vLoginPass: $("#txtNewPass1").val(),
                cLockFlag: 'N',
                iModifyBy: $("#hdnuserid").val(),
                cStatusIndi: 'E',
                DATAOPMODE: 4
            }
            $.ajax({
                url: BaseUrl + "PmsUserMaster/InsertDataUserMaster",
                type: 'POST',
                data: SaveUserMasterData,
                async: false,
                success: SuccessInsertData1,
                error: function () {
                    alert("Error while saving details of User Masters.");
                }
            });

            function SuccessInsertData1(jsonData) {
                if (jsonData.length != 0) {
                    alert((jsonData[0].strMessage).toString());
                    if(jsonData[0].strMessage == "Change Password Successfully")
                        updateExpiredate()
                }
                else {

                    alert("User details saved Successfully.");
                    updateExpiredate()
                }
            }
            $("#txtOldPass1").val('');
            $("#txtNewPass1").val('');
            $("#txtConfirmPass1").val('');
            if ($(".form-control").hasClass("parsley-success")) {
                $(".form-control").removeClass("parsley-success");
            }
            if ($(".form-control").hasClass("parsley-error")) {
                $(".form-control").removeClass("parsley-error")
            }
            if ($(".form-control").next().hasClass("filled")) {
                $(".form-control").next().removeClass("filled")
            }
        }

        function updateExpiredate(){
            $("#hdnExpired").val('N');
            $("#hdnLoginPass").val($("#txtNewPass1").val());
            $("#divChangePassword1").modal('hide');
            $('#changeClose,#btnExitChangepass1').show();
                    
            $.ajax({
                type: "GET",
                url: WebUrl + "PmsHome/UpdateExpired",
                data: { strPassword: $("#txtNewPass1").val() },                
                dataType: "json",
                async: false,
                success: OnSuccessUpdate,
                error: OnErrorCallUpdate
            });

            function OnSuccessUpdate(jsonData) {
                //alert(jsonData);
            }
            function OnErrorCallUpdate(ex) {
                //alert(ex);
            }
        }

        $(document).ready(function () {
            $("#spnwelcome").html('@Session["UserNameWithProfile"]');
            $("#spnLoginTime").html('@Session["LoginTime"]');
            $("#spnLastLoggedInTime").html('@Session["dLastLoggdInTime"]');

            $("#Logout").on("click", function () {
                LogoutEntry();
                location.href = '@Url.Action("Login", "PMSLogin")';

            });
            GetProfile1();
            GetLocation();

            var valueSelected = '@Session["UserTypeCode"]';
            var GetMenu = {
                Url: BaseUrl + "PmsStorageLocation/GetProfileWiseMenu/" + valueSelected + "",
                SuccessMethod: "SuccessMethod"
            }

            bindMenu(GetMenu, valueSelected);
            $('.qtycontrol').on('keypress', function (e) {
                if (!((e.keyCode > 95 && e.keyCode < 106)
                  || (e.keyCode > 47 && e.keyCode < 58)
                  || e.keyCode == 8
                    || e.keyCode == 9)) {
                    return false;
                }
            });

            //if ($("#hdnLoginName").val().trim() === $("#hdnLoginPass").val()) {

            //    $('#changeClose,#btnExitChangepass1').hide();
            //    $("#divChangePassword1").modal('show');
            //}
            //else
            if ($("#hdnExpired").val() === 'Y') {
                alert("Password Expired, Please change your password.");
                $("#divChangePassword1").modal('show');
                $('#changeClose,#btnExitChangepass1').hide();
            }

        });
        function GetProfile1() {
            var username = $('#hdnUserName').val();
            $('#ddlProfile').val('');
            $('#ddlProfile').empty();
            $.ajax({
                url: BaseUrl + "PmsLogin/GetUserprofile",
                type: 'GET',
                data: { id: username },
                dataType: 'json',
                success: SuccessMethod,
                error: function (ex) {
                    alert('Failed to retrieve Sub Categories : ' + ex);
                }
            });
            function SuccessMethod(jsonData) {
                if (jsonData.length != 0) {
                    //window.sessionStorage.setItem("UserNameWithProfile", jsonData.UserNameWithProfile);
                }
                $.each(jsonData, function (i, items) {
                    if (this['vUserTypeCode'] == $('#hdnUserTypeCode').val()) {
                        $("#ddlProfile").append($("<option selected='selected'></option>").val(this['vUserTypeCode']).html(this['vUserTypeName']));
                        $("#spnprofile").html(this['vUserTypeName']);
                    }
                    else {
                        $("#ddlProfile").append($("<option></option>").val(this['vUserTypeCode']).html(this['vUserTypeName']));
                    }

                });
                RoleOperationRights();
            }
            return false;
        }

        function GetLocation() {
            $('#ddlUserLocation').val('');
            $('#ddlUserLocation').empty();
            var username = $('#hdnUserName').val();

            $.ajax({
                url: BaseUrl + "PmsLogin/GetUserLocation",
                type: 'GET',
                data: { id: username },
                dataType: 'json',
                success: SuccessMethod,
                error: function (ex) {
                    alert('Failed to retrieve Sub Categories : ' + ex);
                }
            });
            function SuccessMethod(jsonData) {
                if (jsonData.length != 0) {
                    //window.sessionStorage.setItem("UserNameWithProfile", jsonData.UserNameWithProfile);
                }
                $.each(jsonData, function (i, items) {
                    if (this['vLocationCode'] == $('#hdnUserLocationCode').val()) {
                        $("#ddlUserLocation").append($("<option selected='selected'></option>").val(this['vLocationCode']).html(this['vLocationName']));
                    }
                    else {
                        $("#ddlUserLocation").append($("<option></option>").val(this['vLocationCode']).html(this['vLocationName']));
                    }

                });
            }
            return false;
        }
        var BaseUrl;
        var IsValid = true;
        var url = window.location.href
        var str1 = window.location.href;
        var str2 = ":57502";
        sessionStorage.setItem("IsChangeProfile", "");
        if (str1.indexOf(str2) != -1) {
			WebUrl = "http://90.0.0.110/SST/SST_LCS/";
			BaseUrl = "http://90.0.0.110/SST/SST_LCSAPI/API/";
		}
		else {
			WebUrl = "http://90.0.0.110/SST/SST_LCS/";
			BaseUrl = "http://90.0.0.110/SST/SST_LCSAPI/API/";

        }
        $('#ddlProfile').on('change', function (e) {
            $("#loader").attr("style", "display:block");
            var optionSelected = $("option:selected", this);
            var valueSelected = this.value;
            var GetMenu = {
                Url: BaseUrl + "PmsStorageLocation/GetProfileWiseMenu/" + valueSelected,
                SuccessMethod: "SuccessMethod"
            }
            //    $('#hdnUserTypeCode').val(valueSelected);
            //    $.ajax({
            //        type: "GET",
            //        url: WebUrl + "PMSLogin/UserProfileType",
            //        data: { ProfileTypeCode: valueSelected },
            //        contentType: "application/json; charset=utf-8",
            //        dataType: "json",
            //        async: false,
            //        success: OnSuccess1,
            //        error: OnErrorCall
            //    });
            //    function OnSuccess1(jsonData) {
            //        RoleOperationRights();
            //    }
            //    function OnErrorCall(ex) {
            //        //alert(ex);
            //    }
            //    ReloadAllPages();
            //    bindMenu(GetMenu);
            //    var url = $("#RedirectToHome").val();
            //    location.href = url;

            //});

            UserAuthenticationProfileChange(valueSelected);
            if (!IsValid) {
                location.href = WebUrl;
                return true;
            }
            sessionStorage.setItem("IsChangeProfile", "true");
            bindMenu(GetMenu, valueSelected);
            var url = $("#RedirectToHome").val();
            location.href = url;

        });

        $('#ddlUserLocation').on('change', function (e) {
            $("#loader").attr("style", "display:block");

            var optionSelected = $("option:selected", this);
            var valueSelected = this.value;

            $('#hdnUserLocationCode').val(valueSelected);
            $.ajax({
                type: "GET",
                url: WebUrl + "PMSLogin/SetUserLocationCode",
                data: { UserLocationCode: valueSelected },
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: OnSuccess1,
                error: OnErrorCall
            });
            function OnSuccess1(jsonData) {

            }
            function OnErrorCall(ex) {
                //alert(ex);
            }
            var url = $("#RedirectToHome").val();
            location.href = url;
        });

        function bindMenu(GetMenu, valueSelected) {


            // uncomment when upload it on live

            $.ajax({
                type: "GET",
                url: BaseUrl + "PmsStorageLocation/GetProfileWiseMenu",
                data: { id: valueSelected },
                // contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: SuccessMethod,
                error: function () {
                    alert("Menu Is Not Bind!");
                }
            });


            function SuccessMethod(jsonData) {
                document.getElementById("DyanamicMenu").innerHTML = "";
                var childform = jsonData;
                var strmenu = "";
                for (var i = 0; i < jsonData.length; i++) {
                    if (jsonData[i].ParentID == null) {
                        strmenu += '<li class="treeview">';

                        strmenu += '<a href=' + jsonData[i].MenuURL + '>';

                        strmenu += '<i class="' + jsonData[i].vOperationClassName + '"></i>';

                        strmenu += '<span>' + jsonData[i].MenuText + '</span>';

                        strmenu += '<i class="fa fa-angle-left pull-right"></i>';
                        strmenu += '</a>';
                        strmenu += '<ul class="treeview-menu">';
                        if (jsonData[i].MenuURL != '#') {
                            strmenu += '<li ><a href= "' + jsonData[i].MenuURL + '" id="' + jsonData[i].MenuID + '" onmouseup=GetMenuId(this)><i class="fa fa-location-arrow"></i>' + jsonData[i].MenuText + '</a></li>'
                        }
                    }
                    //strmenu += '<ul class="treeview-menu">';
                    for (var j = i; j < childform.length; j++) {
                        if (jsonData[i].MenuID === childform[j].ParentID) {
                            strmenu += '<li ><a href= "' + childform[j].MenuURL + '" id="' + jsonData[j].MenuID + '" onmouseup=GetMenuId(this) onmousedown=GetMenuId(this) ><i class="fa fa-location-arrow"></i>' + childform[j].MenuText + '</a></li>'
                        }
                    }
                    if (jsonData[i].ParentID == null) {
                        strmenu += '</ul>';
                        strmenu += '</li>';
                    }

                }
                $("#DyanamicMenu").append(strmenu);

            }

        }


        function GetMenuId(e) {
            //alert(e.id);
            MenuID = e.id;
            $('#hdnOprationCode').val(e.id);
            $.ajax({
                type: 'GET',
                url: WebUrl + "PMSLogin/GetOperationCode",
                data: { id: e.id },
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: OnSuccess1,
                error: OnErrorCall
            });

            function OnSuccess1(jsonData) {
                alert('Redirect Pages!');
            }

            function OnErrorCall(ex)
            { }

        }

        function RoleOperationRights() {            
            var CurrentURL = window.location.href.split("/")[window.location.href.split("/").length - 1];
            var OperationPath = "..\\" + window.location.href.split("/")[window.location.href.split("/").length - 2] + "\\" + window.location.href.split("/")[window.location.href.split("/").length - 1];

            if (CurrentURL.indexOf("Home") < 0) {
                var PostData = {
                    WhereCondition_1: "vUserTypeCode ='" + $('#ddlProfile :selected').val() + "' AND vOperationPath = '" + OperationPath + "'  AND cOperationType='PM' AND cActiveFlag = 'Y'",
                    DataRetrieval_1: 3,
                    columnName_1: " Count(vOperationCode) AS countNotification "
                }
                $.ajax({
                    url: BaseUrl + "PmsRecordFetch/RoleOperationRights",
                    type: 'POST',
                    data: PostData,
                    success: SuccessMethod,
                    async: false,
                    error: function () {
                        SuccessorErrorMessageAlertBox("Error For Check Page Rights !", ModuleName);
                    }
                });

                function SuccessMethod(jsonData) {
                    if (jsonData.Table[0].countNotification == "0") {
                        alert("You have no rights to open this functionality !");
                        var url = $("#RedirectToHome").val();
                        location.href = url;
                        return false;
                    }
                }
            }
        }


        function ReloadAllPages() {
        }
        function UserAuthenticationProfileChange(valueSelected) {
            var loginDetails = {
                vUserName: $('#hdnUserName').val(),
                vLoginPass: "",
                vUserTypeCode: valueSelected,
                vIPAddress: $('#hdnIpAddress').val(),
                vUserAgent: $("#hdnvUserAgent").val(),
                vGUID: '@Session["vGUID"]',
            };

            //For Logout old profile login from $(document).ajaxStart(
            sessionStorage.setItem("IsChangeProfile", "true");

            //For Get Selected profile detail
            $.ajax({
                url: BaseUrl + "PmsLogin/PostLoginAuthentication",
                type: 'POST',
                data: loginDetails,
                dataType: 'json',
                async: false,
                success: LoginAuthentication_Success,
                error: function (ex) {
                    alert('Profile change Failed. Try Again.!: ' + ex);
                    return false;
                }
            });
            return true;
        }

        function LoginAuthentication_Success(jsonData) {           
            var resultLogin = true;

            if (jsonData.Data.length != 0) {
                if (jsonData.Data[0].cBlockedFlag == 'Y') {
                    alert("Your username is locked due to multiple incorrect login attempts !!!");
                    resultLogin = false;
                }
                else if (jsonData.Data[0].cBlockedFlag == 'E') {
                    alert("Login Failed. Try Again.! ");
                    resultLogin = false;
                }
                else if (jsonData.Data[0].cLockFlag == 'Y' && jsonData.Data[0].cInactive == 'Y') {
                    alert("Your username is locked, as the user is inactive since 30 days, Please contact Administrator.");
                    resultLogin = false;
                }
                else if (jsonData.Data[0].cLockFlag == 'Y' && jsonData.Data[0].cInactive == 'N') {
                    alert("Your username is locked due to multiple incorrect login attempts, Please contact Administrator.");
                    resultLogin = false;
                }
                else if (jsonData.Data[0].cLockFlag == 'N' && jsonData.Data[0].cInactive == 'Y') {
                    alert("Your username is locked, as the user is inactive since 30 days !!!");
                    resultLogin = false;
                }

                if (resultLogin != false) {

                    //For Save Selected profile detail in DB
                    var SaveUserLoginData = {
                        iUserId: jsonData.Data[0].iUserId,
                        vIPAddress: $('#hdnIpAddress').val(),
                        vUTCHourDiff: jsonData.Data[0].vUTCHourDiff,
                        vUserAgent: $("#hdnvUserAgent").val(),
                        vGUID: '@Session["vGUID"]',
                        DataopMode: 1
                    }
                    $.ajax({
                        url: BaseUrl + "PmsLogin/save_UserLoginDetails",
                        type: 'POST',
                        data: SaveUserLoginData,
                        async: false,
                        success: function () { },
                        error: function () {
                            alert("Error while saving details of User Login details !");
                        }
                    });


                    window.sessionStorage.setItem("UserNameWithProfile", jsonData.Data[0].UserNameWithProfile);
                    var UserDetails = {};
                    UserDetails.iUserId = jsonData.Data[0].iUserId;
                    UserDetails.iUserGroupCode = jsonData.Data[0].iUserGroupCode;
                    UserDetails.vUserGroupName = jsonData.Data[0].vUserGroupName;
                    UserDetails.vUserName = jsonData.Data[0].vUserName;
                    UserDetails.vLoginName = jsonData.Data[0].vLoginName;
                    UserDetails.vLoginPass = jsonData.Data[0].vLoginPass;
                    UserDetails.vUserTypeCode = $('#ddlProfile').val();
                    UserDetails.vUserTypeName = jsonData.Data[0].vUserTypeName;
                    UserDetails.vDeptCode = jsonData.Data[0].vDeptCode;
                    UserDetails.vDeptName = jsonData.Data[0].vDeptName;
                    UserDetails.vLocationCode = jsonData.Data[0].vLocationCode;
                    UserDetails.vLocationName = jsonData.Data[0].vLocationName;
                    UserDetails.vTimeZoneName = jsonData.Data[0].vTimeZoneName;
                    UserDetails.vLocationInitiate = jsonData.Data[0].vLocationInitiate;
                    UserDetails.vEmailId = jsonData.Data[0].vEmailId;
                    UserDetails.vPhoneNo = jsonData.Data[0].vPhoneNo;
                    UserDetails.vExtNo = jsonData.Data[0].vExtNo;
                    UserDetails.vRemark = jsonData.Data[0].vRemark;
                    UserDetails.iModifyBy = jsonData.Data[0].iModifyBy;
                    UserDetails.dModifyOn = jsonData.Data[0].dModifyOn;
                    UserDetails.cStatusIndi = jsonData.Data[0].cStatusIndi;
                    UserDetails.vFirstName = jsonData.Data[0].vFirstName;
                    UserDetails.vLastName = jsonData.Data[0].vLastName;
                    UserDetails.nScopeNo = jsonData.Data[0].nScopeNo;
                    UserDetails.vScopeName = jsonData.Data[0].vScopeName;
                    UserDetails.vScopeValues = jsonData.Data[0].vScopeValues;
                    UserDetails.iWorkflowStageId = jsonData.Data[0].iWorkflowStageId;
                    UserDetails.cIsEDCUser = jsonData.Data[0].cIsEDCUser;
                    UserDetails.dFromDate = jsonData.Data[0].dFromDate;
                    UserDetails.dToDate = jsonData.Data[0].dToDate;
                    UserDetails.ModifierName = jsonData.Data[0].ModifierName;
                    UserDetails.UserNameWithProfile = jsonData.Data[0].UserNameWithProfile;
                    UserDetails.tmp_dModifyOn = jsonData.Data[0].tmp_dModifyOn;
                    UserDetails.OperationCode = $("#hdnOprationCode").val();
                    UserDetails.tmp_dModifyOn = jsonData.Data[0].tmp_dModifyOn;
                    UserDetails.UserWise_CurrDateTime = jsonData.Data[0].UserWise_CurrDateTime;
                    UserDetails.dLastLoggdInTime = jsonData.Data[0].dLastLoggdInTime;
                    UserDetails.vGUID = '@Session["vGUID"]';

                    //For Save Selected profile detail in Session
                    $.ajax({
                        type: "POST",
                        url: WebUrl + "PMSLogin/UserDetails",
                        data: JSON.stringify(UserDetails),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        async: false,
                        success: OnSuccess1,
                        error: OnErrorCall
                    });
                    function OnSuccess1(jsonData) {
                        //alert(jsonData);
                    }
                    function OnErrorCall(ex) {

                    }
                    resultLogin = true;
                }

            }
            else {
                resultLogin = false;
            }
            IsValid = resultLogin;
            return resultLogin;
        }

        $("#btnExitChangepass1").on("click", function () {
            var result = confirm(ConfirmMessage);
            if (result) {
                $("#divChangePassword1").modal('hide');
            }
            else {
                return false;
            }
        });

        $('#formChangePassword1').parsley().subscribe('parsley:field:validate', function () {
            if ($('#formChangePassword1').parsley().isValid()) {
                $('#btnChangePass1').prop('disabled', false);
            } else {
                $('#btnChangePass1').prop('disabled', true);
            }
        });

    </script>

    @*    @Scripts.Render("~/bundles/jquery") 
    @Scripts.Render("~/Script") *@

</body>
</html>
